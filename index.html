<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Vibesim</title>
  <link rel="stylesheet" href="style.css">
  <script>
    window.MathJax = {
      tex: { inlineMath: [["$", "$"], ["\\(", "\\)"]] },
      svg: { fontCache: "global" },
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js" defer></script>
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="brand-title">Vibesim</div>
      <div class="version">v0.1.239</div>
    </div>
    <div class="controls">
      <label class="runtime">Runtime (s)
        <input id="runtimeInput" type="number" value="10" step="0.5" min="0.1">
      </label>
      <button id="runBtn">Run</button>
      <button id="clearBtn">Clear</button>
      <button id="saveBtn">Save</button>
      <button id="loadBtn">Load</button>
      <input id="loadInput" type="file" accept=".yaml,.yml,text/yaml" hidden>
      <span id="status" class="status">Idle</span>
    </div>
  </header>

  <main class="layout">
    <aside class="toolbox">
      <h2>Toolbox</h2>
      <details class="tool-group" open>
        <summary>Source</summary>
        <button class="tool" data-type="constant">Constant</button>
        <button class="tool" data-type="step">Step</button>
        <button class="tool" data-type="ramp">Ramp</button>
        <button class="tool" data-type="impulse">Impulse</button>
        <button class="tool" data-type="sine">Sine</button>
        <button class="tool" data-type="chirp">Chirp</button>
        <button class="tool" data-type="noise">Noise</button>
        <button class="tool" data-type="fileSource">File</button>
        <button class="tool" data-type="labelSource">Label</button>
      </details>
      <details class="tool-group" open>
        <summary>Continuous</summary>
        <button class="tool" data-type="integrator">Integrator</button>
        <button class="tool" data-type="tf">Transfer Function</button>
        <button class="tool" data-type="delay">Delay</button>
        <button class="tool" data-type="stateSpace">State Space</button>
        <button class="tool" data-type="lpf">LPF</button>
        <button class="tool" data-type="hpf">HPF</button>
        <button class="tool" data-type="derivative">Derivative</button>
        <button class="tool" data-type="pid">PID</button>
      </details>
      <details class="tool-group" open>
        <summary>Math</summary>
        <button class="tool" data-type="gain">Gain</button>
        <button class="tool" data-type="sum">Addition</button>
        <button class="tool" data-type="mult">Multiplication</button>
      </details>
      <details class="tool-group" open>
        <summary>Discrete</summary>
        <button class="tool" data-type="zoh">ZOH</button>
        <button class="tool" data-type="foh">FOH</button>
        <button class="tool" data-type="dtf">Discrete TF</button>
        <button class="tool" data-type="ddelay">Discrete Delay</button>
        <button class="tool" data-type="dstateSpace">Discrete State Space</button>
      </details>
      <details class="tool-group" open>
        <summary>Nonlinear</summary>
        <button class="tool" data-type="saturation">Saturation</button>
        <button class="tool" data-type="rate">Rate Limit</button>
        <button class="tool" data-type="backlash">Backlash</button>
      </details>
      <details class="tool-group" open>
        <summary>Sink</summary>
        <button class="tool" data-type="scope">Scope</button>
        <button class="tool" data-type="fileSink">Output File</button>
        <button class="tool" data-type="labelSink">Label</button>
      </details>
      <div id="inspector" class="inspector">
        <h3>Properties</h3>
        <div id="inspectorBody" class="inspector-body">Select a block or wire.</div>
        <button id="rotateSelection" class="secondary">Rotate</button>
        <button id="deleteSelection" class="danger">Delete</button>
      </div>
      <div id="variablesPanel" class="variables-panel">
        <h3>Variables</h3>
        <textarea id="variablesInput" rows="6" placeholder="k=2&#10;w=3.14"></textarea>
        <button id="applyVariables" class="secondary">Apply</button>
        <div id="variablesPreview" class="variables-preview"></div>
      </div>
      <div id="debugPanel" class="debug-panel">
        <h3>Debug</h3>
        <button id="copyDebug" class="secondary">Copy debug</button>
        <pre id="debugLog">Routing debug output will appear here.</pre>
      </div>
    </aside>

    <section class="workspace">
      <div id="canvas">
        <div class="floating-controls">
          <button id="fullRouteBtn" class="floating-btn" aria-label="Full reroute" title="Full reroute">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <rect x="2.5" y="4" width="5" height="5" rx="1" />
              <rect x="16.5" y="10" width="5" height="5" rx="1" />
              <rect x="2.5" y="16" width="5" height="5" rx="1" />
              <path d="M7.5 6.5H13M13 6.5V12.5H16.5M7.5 18H13M13 18V12.5" />
            </svg>
          </button>
          <button id="homeBtn" class="floating-btn" aria-label="Home" title="Home">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path d="M4 11l8-6 8 6M6 10v9h12v-9" />
            </svg>
          </button>
          <button id="zoomInBtn" class="floating-btn" aria-label="Zoom in" title="Zoom in">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <circle cx="11" cy="11" r="7" />
              <path d="M11 8v6M8 11h6M16.5 16.5L21 21" />
            </svg>
          </button>
          <button id="zoomOutBtn" class="floating-btn" aria-label="Zoom out" title="Zoom out">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <circle cx="11" cy="11" r="7" />
              <path d="M8 11h6M16.5 16.5L21 21" />
            </svg>
          </button>
        </div>
        <svg id="svgCanvas">
          <g id="wireLayer"></g>
          <g id="blockLayer"></g>
          <g id="overlayLayer"></g>
        </svg>
      </div>
    </section>
  </main>

  <script type="module" src="app.js"></script>
</body>
</html>
